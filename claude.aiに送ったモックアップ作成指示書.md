# ローカルLLM売上予測ツール モックアップ仕様書

## 概要

ビジネス・アナリスト向けの売上予測ツールのモックアップ作成仕様書です。ローカルLLMを活用し、ユーザーとの対話を通じて自動的に予測モデルを構築するツールを開発します。

## 開発環境

- **ハードウェア**: Apple MacBook Air M3 2024
- **メモリ**: 16GB
- **OS**: MacOS 15.6.1（24G90）

## ツール概要

### 基本機能
- 売上予測の予測値を作成するツール
- ローカルLLMが自動でPythonモデルを作成することで予測を実現
- 時系列を含むデータを受け取り、対話的に予測モデルの仕様を策定
- 予測値の提供、正確性の説明、根拠の説明が可能

### 特徴
- **ローカル稼働**: データは外部に漏れず、機密保持が可能
- **対話型設計**: ツール側から問いかけを行い、ユーザーが回答することで分析計画を策定
- **ビジネス用語対応**: ビジネス・アナリストが普段使用する用語で操作可能

## 想定ユーザー

- **対象**: ビジネス・アナリスト
- **スキルレベル**:
  - Excel使用経験あり（数字を見ることに抵抗なし）
  - 統計学の学習経験なし（今後学習意欲あり）
  - 機械学習の実装経験なし

## 開発目的

1. ビジネス・アナリストが将来の予測値を出すことができるようにする
2. 予測値の意味を説明できるようにする
3. 予測値の信頼性を説明できるようにする
4. 予測値の導出過程を説明できるようにする

## モックアップ作成範囲

### 1. 環境構築
- **LLMのおすすめとインストール・スクリプト**
- **環境設定スクリプト**:
  - LLM環境
  - LLMそのもの
  - UI環境（Streamlitなど）
  - Python conda環境

### 2. 主要機能のPythonコード

#### 2.1 対話UI機能
- ユーザーへの問いかけができるUI
- 実際に問いかけるPythonプログラム

#### 2.2 分析仕様策定機能
- ユーザーからの回答を得て、予測モデルの仕様を策定するコード

#### 2.3 予測モデル構築機能
- 分析仕様に従って予測モデルを構築するプログラム

#### 2.4 予測値出力機能
- 構築した予測モデルを活用して予測値を出力するコードを自動生成する仕組み

#### 2.5 モデル解説機能
- 構築した予測モデルを解説する機能
  - レポート出力方法
  - ユーザーからの質問に答える方法

## ユーザーとの対話設計（重要）

### 重要①: ビジネス目的の理解

#### 基本方針
- **オープン・クエスチョンは厳禁**
  - 「ビジネス目的は何ですか？」のような質問は避ける
- **クローズド・クエスチョン中心**
  - Yes/Noで答えられる質問を優先

#### 対話フロー
1. **業界の確認**
   - 「ユーザー様の業界は何になりますか？」
   - 想定回答例：「病院です」

2. **目的の推定と確認**
   - 系列の名前と内容から類推
   - 例：「ビジネス目的としては、将来の受診者数を予測して、ドクターやナースの配置計画に活かしたい、ということですか？」
   - Noの場合：「予測の受診者数の値をどのように使いますか？」

3. **系列内容の確認**
   - 系列の名前が不明な場合：「この数字の列は何の数字ですか？」
   - 業種情報と組み合わせてクローズドクエスチョンを作成

### 重要②: データ傾向の発見

#### 確認項目
- **基本構造**: 時間を表す列と系列を表す列の確認
- **時系列要素**: トレンド、季節性、ランダム要素の分析
- **欠損パターン**: 特定タイミングでの欠損値発見
  - 例：深夜時間帯、土日祝、年末年始、年度始め4月
- **ピーク・トラフパターン**: 特定タイミングでの特徴発見
  - 例：毎朝9時過ぎ、午後1時過ぎ、月曜、祝日明け
- **データ数の評価**: 
  - 元データの行数確認
  - サマリー化後のデータ数での予測可能性評価
  - 例：2022年4月〜2025年8月の1000行以上のデータを週単位でサマリーすると200行程度になり、時系列予測にギリギリ耐えられるレベル

## 分析計画の自動策定

### プロセス
1. **ビジネス目的の理解** (重要①から)
   - 例：受診者数を把握し、月毎の目標受診者数に対する不足数を推定、追加募集の判断材料とする

2. **データ特徴の理解** (重要②から)
   - 例：土日祝・GW・年末年始が欠損値、週別サマリー（1日平均受診者数）の方が系列が安定

3. **目的とデータ特徴の整合性確認**
   - ビジネス目的：月別予測（各月の受診者数1日あたり）
   - 技術的可能性：週別サマリーでの週別予測

4. **分析計画の策定**
   - 重要①と重要②のメモから簡潔かつ要点を落とさないステートメントを作成

## 分析プロセスの自動実行

### データ準備
- 分析計画に従ったデータの前処理
- 例：週別サマリーデータの作成

### モデル構築
- 分析計画に従った時系列予測モデルの構築
- 統計量やグラフの保持
- 学習・検証データの適切な分割
- 予測精度の統計量保持

### 精度管理
- **内部基準**: MAPE < 10%
- **改善アプローチ**（基準未達成時）:
  1. データ準備方法の修正
     - 週別サマリーの計算方法変更（平均→中央値→最大値）
     - 日別データでの欠損値処理、曜日の外部変数化
  2. 学習・検証データ区分の変更
  3. 予測アルゴリズムの変更（ARIMA→SARIMA→Prophet）

### 最終判定
- 複数回の改善でもMAPE < 10%に達しない場合
- 最良のモデルを採用し、精度の課題と改善案をステートメント化

## アウトプット機能

### 予測値のダウンロード
- CSV形式でのダウンロード機能

### モデル解説機能

#### 「予測のしくみのアウトプット」（PDF出力）
1. **分析計画とその理由**
2. **予測値の導出過程**
3. **ビジネスアナリスト向けの説明資料**

#### 例示内容
- **分析計画とその計画にした理由**: 週別サマリーデータ（1日平均受診者数）を使用した理由は、土日祝・年末年始の欠損値が多く、日別データでは系列が不安定だったため。月別予測を行う目的に対し、週別予測から月別集計することで十分な精度を確保
- 受診者数は前週が前々週に比べて増加すれば増加する傾向
- 季節的には初夏がピーク
- 予測値の±5%に実際の受診者数が入る精度
- 過去データでのバックテスト結果
- 予測値の活用方法（週別予測値をExcelで加工し、月別追加募集数を算出、健保組合への働きかけなど）

#### ユーザー質問への対応
想定される3つのジャンルの質問に対応：
1. **使い方**: 「この予測値をどう使えば良いのか」
2. **信頼性**: 「この予測値は信用できるのか・正確なのか・どの程度正確か」
3. **根拠**: 「この予測値はどのように得られたのか、自分が説明できるようにしてほしい」

## 対象予測アルゴリズム

- **主要対象**: 時系列解析
- **候補手法**: ARIMA、SARIMA、Prophet

---

*この仕様書に基づいて、ローカルLLMを活用した売上予測ツールのモックアップを作成してください。*